<div class="admin-list-detail-container">
  <!-- Header with title and add button -->
  <div class="header">
    <h1 class="page-title">{{ title }}</h1>
    @if (showAddButton) {
      <button
        mat-raised-button
        color="primary"
        (click)="onAdd()"
        class="add-button"
      >
        <mat-icon>add</mat-icon>
        {{ addButtonText }}
      </button>
    }
  </div>

  <!-- Filter section (projected content) -->
  @if (hasFilterContent()) {
    <div class="filter-section">
      <ng-content select="[filter]"></ng-content>
    </div>
  }

  <!-- Error message -->
  @if (errorMessage()) {
    <div class="error-message" role="alert">
      <mat-icon>error</mat-icon>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  <!-- Loading spinner -->
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading...</p>
    </div>
  }

  <!-- Data table -->
  @if (!isLoading() && !errorMessage()) {
    <div class="table-container">
      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        class="mat-elevation-z2"
      >
        <!-- Dynamic columns from configuration -->
        @for (column of columns; track column.key) {
          <ng-container [matColumnDef]="column.key">
            <th
              mat-header-cell
              *matHeaderCellDef
              [mat-sort-header]="column.sortable ? column.key : undefined"
              [class]="column.headerClass || ''"
              [style.min-width]="column.minWidth"
              [style.max-width]="column.maxWidth"
              [style.width]="column.width"
            >
              {{ column.label }}
            </th>
            <td
              mat-cell
              *matCellDef="let row"
              [class]="column.cellClass || ''"
              [style.min-width]="column.minWidth"
              [style.max-width]="column.maxWidth"
              [style.width]="column.width"
            >
              @if (column.template) {
                <ng-container
                  *ngTemplateOutlet="column.template; context: { $implicit: row }"
                >
                </ng-container>
              } @else {
                {{
                  column.valueGetter ? column.valueGetter(row) : row[column.key]
                }}
              }
            </td>
          </ng-container>
        }

        <!-- Actions column (optional, projected content) -->
        @if (showActionsColumn) {
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-header"></th>
            <td mat-cell *matCellDef="let row" class="actions-cell">
              <ng-content select="[actions]"></ng-content>
            </td>
          </ng-container>
        }

        <!-- Table headers and rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns()"
          (click)="onRowClick(row)"
          [class.clickable-row]="rowClickable"
        ></tr>

        <!-- Empty state row -->
        <tr class="mat-row no-data-row" *matNoDataRow>
          <td class="mat-cell empty-state-cell" [attr.colspan]="displayedColumns().length">
            <ng-content select="[empty-state]">
              <div class="default-empty-state">
                <mat-icon>inbox</mat-icon>
                <p>No records found.</p>
                @if (showAddButton) {
                  <p class="empty-state-hint">
                    Click "{{ addButtonText }}" to get started.
                  </p>
                }
              </div>
            </ng-content>
          </td>
        </tr>
      </table>

      <!-- Pagination -->
      <mat-paginator
        [pageSizeOptions]="pageSizeOptions"
        [pageSize]="defaultPageSize"
        [showFirstLastButtons]="true"
        [aria-label]="paginatorAriaLabel"
      >
      </mat-paginator>
    </div>
  }
</div>

<!-- Detail form/dialog (projected content) -->
<ng-content select="[detail-form]"></ng-content>
